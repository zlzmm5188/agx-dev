# AGX 业务规则文档

> 本文档定义 AGX 平台的核心业务规则，包括资金流向、推广返佣、邀请机制等。
> 所有开发必须严格遵守这些规则。

---

## 一、账户体系

### 1.1 注册规则

| 规则 | 说明 |
|------|------|
| 注册方式 | 仅需**用户名 + 密码** |
| 邀请码 | **必填**，没有邀请码无法注册 |
| 无需验证 | 不需要手机号、邮箱验证 |
| UID 生成 | 系统自动生成 8 位数字 UID |
| 邀请码生成 | 注册成功后自动生成 6 位邀请码 |

### 1.2 登录规则

| 规则 | 说明 |
|------|------|
| 登录方式 | 用户名 + 密码 |
| Token 有效期 | 7 天 |
| 同时在线 | 允许多设备同时登录 |

### 1.3 实名认证（KYC）

> **必须实名后才能购买项目（矿池、秒合约等）**

**认证流程：**
```
1. 上传身份证正面照片
   ↓
2. OCR自动识别身份证信息（姓名、身份证号）
   ↓
3. 用户确认识别结果
   ↓
4. 拍摄自拍照（仅启用前置摄像头）
   ↓
5. 活体检测（检测是否真人、是否拍屏幕）
   ↓
6. 提交后台审核
   ↓
7. 审核通过/拒绝
```

**技术要求：**
| 功能 | 说明 |
|------|------|
| OCR识别 | 身份证号码、姓名自动识别，用户不能手动填写 |
| 前置摄像头 | 自拍只启用前置摄像头 |
| 活体检测 | 检测是否真人、是否拍摄屏幕 |
| 后台审核 | 人工审核认证材料 |

**KYC状态：**
| 状态 | 说明 |
|------|------|
| 0 | 未认证 |
| 1 | 审核中 |
| 2 | 已认证 |
| 3 | 审核失败 |

### 1.4 用户层级

每个用户都有邀请人，形成邀请链：

```
顶级用户 (平台预设)
    └── 一级用户 A (由顶级邀请)
        └── 二级用户 B (由 A 邀请)
            └── 三级用户 C (由 B 邀请)
                └── ...
```

---

## 二、推广返佣机制

### 2.1 返佣模式（参考币安）

采用**多级返佣**模式，邀请人可从被邀请人的交易手续费中获得返佣。

| 层级 | 返佣比例 | 说明 |
|------|----------|------|
| 一级（直接邀请） | 20% | 直接邀请的用户产生的手续费 |
| 二级（间接邀请） | 10% | 被邀请人再邀请的用户产生的手续费 |

**示例：**
- A 邀请 B，B 邀请 C
- C 交易产生 10 USDT 手续费
- B 获得：10 × 20% = 2 USDT（一级）
- A 获得：10 × 10% = 1 USDT（二级）
- 平台获得：10 - 2 - 1 = 7 USDT

### 2.2 返佣结算

| 项目 | 规则 |
|------|------|
| 结算周期 | 实时结算（每笔交易完成后立即到账） |
| 到账钱包 | 佣金直接到返佣账户（可提现或划转） |
| 最低提现 | 10 USDT |
| 返佣币种 | 与手续费币种一致（通常为 USDT） |

### 2.3 返佣数据表设计

```sql
-- 返佣记录表
CREATE TABLE commission_records (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  user_id BIGINT UNSIGNED NOT NULL COMMENT '获得返佣的用户ID',
  from_user_id BIGINT UNSIGNED NOT NULL COMMENT '产生交易的用户ID',
  order_id BIGINT UNSIGNED NOT NULL COMMENT '关联订单ID',
  level TINYINT NOT NULL COMMENT '返佣层级: 1=一级, 2=二级',
  trade_fee DECIMAL(32, 8) NOT NULL COMMENT '原始手续费',
  commission_rate DECIMAL(5, 4) NOT NULL COMMENT '返佣比例',
  commission_amount DECIMAL(32, 8) NOT NULL COMMENT '返佣金额',
  currency VARCHAR(20) NOT NULL DEFAULT 'USDT' COMMENT '币种',
  status TINYINT DEFAULT 1 COMMENT '状态: 0=待结算, 1=已结算',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  
  INDEX idx_user_id (user_id),
  INDEX idx_from_user_id (from_user_id),
  INDEX idx_order_id (order_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='返佣记录表';

-- 用户邀请关系表
CREATE TABLE user_invitations (
  id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  user_id BIGINT UNSIGNED NOT NULL UNIQUE COMMENT '用户ID',
  inviter_id BIGINT UNSIGNED DEFAULT NULL COMMENT '直接邀请人ID',
  inviter_level2_id BIGINT UNSIGNED DEFAULT NULL COMMENT '二级邀请人ID（邀请人的邀请人）',
  invite_code VARCHAR(10) NOT NULL COMMENT '我的邀请码',
  invite_count INT DEFAULT 0 COMMENT '我邀请的人数',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  
  UNIQUE KEY uk_invite_code (invite_code),
  INDEX idx_inviter_id (inviter_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户邀请关系表';
```

---

## 三、充值与资金

### 3.1 充值方式

| 充值方式 | 说明 |
|----------|------|
| 人民币（CNY） | 银行转账/支付宝/微信，平台收款后人工确认到账 |
| USDT | 链上充值（TRC20/ERC20/BEP20） |

### 3.2 充值地址绑定

| 规则 | 说明 |
|------|------|
| 绑定地址 | 用户需绑定自己的充值地址（银行卡/钱包地址） |
| 修改地址 | **不能自己修改**，需联系客服审核修改 |
| 安全级别 | 修改地址需要重新实名认证或客服人工审核 |

### 3.3 资金账户类型

每个用户有以下账户：

| 账户类型 | 代码 | 说明 |
|----------|------|------|
| 现货账户 | `spot` | 用于现货交易 |
| 返佣账户 | `commission` | 推广返佣收入 |
| 理财账户 | `earn` | 理财/质押资产 |

### 3.2 资金流入

| 来源 | 去向 | 说明 |
|------|------|------|
| 充值 | 现货账户 | 用户充值的资产 |
| 交易返佣 | 返佣账户 | 下级用户交易产生的返佣 |
| 理财利息 | 理财账户 | 理财产品产生的收益 |

### 3.3 资金流出

| 来源 | 去向 | 说明 |
|------|------|------|
| 现货账户 | 提现 | 用户提现 |
| 现货账户 | 交易 | 交易扣款（买入）|
| 现货账户 | 手续费 | 交易手续费 |
| 理财账户 | 现货账户 | 理财赎回 |

### 3.4 账户划转

用户可在以下账户间自由划转：

- 现货账户 ↔ 返佣账户
- 现货账户 ↔ 理财账户

---

## 四、交易手续费

### 4.1 现货交易

| 类型 | 费率 | 说明 |
|------|------|------|
| Maker（挂单） | 0.1% | 提供流动性 |
| Taker（吃单） | 0.1% | 消耗流动性 |

### 4.2 手续费分配

每笔手续费的分配：

```
总手续费 100%
├── 一级邀请人返佣: 20%
├── 二级邀请人返佣: 10%
└── 平台收入: 70%
```

---

## 五、矿池产品规则

### 5.1 矿池类型

| 矿池名称 | 锁定期 | 最低申购 | 赎回规则 |
|----------|--------|----------|----------|
| 活期矿池 | 无 | 100 | 实时赎回 |
| 7日矿池 | 7天 | 500 | 到期自动赎回 |
| 30日矿池 | 30天 | 1000 | 到期自动赎回 |
| 90日矿池 | 90天 | 5000 | 到期自动赎回 |

### 5.2 多币种支持（重要！）

> **同一产品可支持不同币种购买，不同币种收益率不同**

**示例：7日矿池**
| 购买币种 | 日利率 | 说明 |
|----------|--------|------|
| 人民币（CNY） | 0.3% | 返利返人民币 |
| USDT | 0.5% | 返利返USDT |

**后台配置：**
- 可设置产品只能用某种币种购买（仅人民币/仅USDT/两者皆可）
- 不同币种可设置不同日利率
- 返利币种 = 购买币种

**数据库设计：**
```sql
-- 矿池产品币种配置表
CREATE TABLE agx_pool_product_coin (
  id            BIGSERIAL PRIMARY KEY,
  product_id    BIGINT NOT NULL,          -- 矿池产品ID
  coin_id       BIGINT NOT NULL,          -- 币种ID（1=CNY, 2=USDT）
  daily_rate    DECIMAL(10,6) NOT NULL,   -- 日利率
  min_amount    DECIMAL(20,8) NOT NULL,   -- 最低申购
  status        SMALLINT DEFAULT 1,       -- 1启用 0禁用
  created_at    TIMESTAMP DEFAULT NOW()
);
```

### 5.3 计息规则

| 规则 | 说明 |
|------|------|
| 开始计息 | T+1（申购次日开始） |
| 收益发放 | 每日 00:00 自动发放 |
| 复利模式 | 不复利 |
| 提前赎回 | 定期不支持 |

---

## 六、秒合约黄金交易规则

### 6.1 交易品种

| 品种 | 代码 | 说明 |
|------|------|------|
| 黄金 | XAU/USD | 主推品种 |
| 白银 | XAG/USD | 扩展品种 |

### 6.2 合约周期

| 周期 | 说明 |
|------|------|
| 30秒 | 快速交易 |
| 60秒 | 标准交易 |
| 2分钟 | - |
| 5分钟 | 稳健交易 |

> 收益率由后台配置，不硬编码

### 6.3 交易规则

| 规则 | 说明 |
|------|------|
| 投入币种 | AGX |
| 最低投入 | 10 AGX |
| 最高投入 | 10,000 AGX |
| 同时持仓 | 最多 5 笔 |
| 结算方式 | 到期自动结算 |

### 6.4 结算逻辑

```
开仓价 = 开仓时刻的金价
结算价 = 到期时刻的金价

如果 方向=看涨 且 结算价 > 开仓价：用户赢
如果 方向=看跌 且 结算价 < 开仓价：用户赢
否则：用户输
```

---

## 六、提现规则

### 6.1 基本规则

| 项目 | 规则 |
|------|------|
| 最低提现 | 10 USDT |
| 单笔上限 | 50,000 USDT |
| 日提现上限 | 100,000 USDT（可根据 KYC 等级调整） |
| 提现手续费 | 固定费用，按链收取 |

### 6.2 提现手续费

| 链 | 手续费 |
|----|--------|
| TRC20 | 1 USDT |
| ERC20 | 5 USDT |
| BEP20 | 0.5 USDT |

### 6.3 审核规则

| 金额 | 审核方式 |
|------|----------|
| < 1,000 USDT | 自动审核 |
| 1,000 - 10,000 USDT | 人工审核（1小时内） |
| > 10,000 USDT | 高级审核（24小时内） |

---

## 七、邀请码规则

### 7.1 邀请码生成

- 格式：6 位大写字母 + 数字
- 示例：`ABC123`、`X9Y8Z7`
- 每个用户唯一

### 7.2 邀请码使用

- 注册时必填
- 一个邀请码可无限次使用
- 绑定后不可更改

### 7.3 特殊邀请码

| 类型 | 说明 |
|------|------|
| 官方码 | 由平台预设，用于初始用户注册 |
| 代理码 | 高级代理的专属码，可享受更高返佣 |

---

## 八、风控规则

### 8.1 账户风控

| 风控项 | 触发条件 | 处理 |
|--------|----------|------|
| 异常登录 | IP/设备异常 | 记录日志，可选验证 |
| 频繁操作 | 短时间大量请求 | 限流 |
| 大额提现 | 超过日限额 | 人工审核 |

### 8.2 资金风控

| 风控项 | 触发条件 | 处理 |
|--------|----------|------|
| 余额不足 | 交易/提现余额不足 | 拒绝操作 |
| 负余额 | 任何账户出现负数 | 系统告警 |
| 异常充值 | 短时间大量充值 | 标记审核 |

---

## 九、系统配置项

这些配置应该可以在后台管理系统中修改：

```json
{
  "commission": {
    "level1_rate": 0.20,
    "level2_rate": 0.10,
    "enabled": true
  },
  "trade": {
    "maker_fee": 0.001,
    "taker_fee": 0.001
  },
  "withdraw": {
    "min_amount": 10,
    "max_amount": 50000,
    "daily_limit": 100000,
    "auto_approve_limit": 1000
  },
  "earn": {
    "flexible_apy": 0.05,
    "fixed_7d_apy": 0.08,
    "fixed_30d_apy": 0.12,
    "fixed_90d_apy": 0.18
  }
}
```

---

**本文档将持续更新，请以最新版本为准。**
