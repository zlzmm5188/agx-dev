<template>
  <PageLayout title="å‡è¾¾æ™ºèƒ½" :show-back="true">
    <template #navbar-right>
      <button class="header-btn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82V9a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9"/>
        </svg>
      </button>
    </template>

    <div class="page-content">
      <!-- AI å¤´éƒ¨ -->
      <div class="ai-header">
        <div class="ai-avatar">
          <svg viewBox="0 0 64 64" fill="none">
            <defs>
              <linearGradient id="aiGrad" x1="0" y1="0" x2="64" y2="64">
                <stop stop-color="#A855F7"/><stop offset="0.5" stop-color="#8B5CF6"/><stop offset="1" stop-color="#6366F1"/>
              </linearGradient>
            </defs>
            <circle cx="32" cy="32" r="28" stroke="url(#aiGrad)" stroke-width="2" fill="none" opacity="0.3"/>
            <circle cx="32" cy="32" r="20" stroke="url(#aiGrad)" stroke-width="2" fill="url(#aiGrad)" fill-opacity="0.1"/>
            <circle cx="32" cy="32" r="10" fill="url(#aiGrad)"/>
            <path d="M32 10v8M32 46v8M10 32h8M46 32h8" stroke="url(#aiGrad)" stroke-width="3" stroke-linecap="round"/>
          </svg>
          <div class="ai-pulse"></div>
        </div>
        <h1 class="ai-title">å‡è¾¾æ™ºèƒ½</h1>
        <p class="ai-desc">æ‚¨çš„ä¸“å±AIæŠ•èµ„é¡¾é—®ï¼ŒåŠ©æ‚¨æŠŠæ¡å¸‚åœºè„‰æ</p>
      </div>

      <!-- åŠŸèƒ½å…¥å£ -->
      <div class="ai-features">
        <div class="feature-card" @click="activeFeature = 'analysis'">
          <div class="feature-icon analysis">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 3v18h18"/><path d="M7 16l4-6 4 3 5-7"/>
            </svg>
          </div>
          <div class="feature-info">
            <span class="feature-name">è¡Œæƒ…åˆ†æ</span>
            <span class="feature-desc">æ™ºèƒ½åˆ†æå¸‚åœºèµ°åŠ¿</span>
          </div>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
        </div>
        <div class="feature-card" @click="activeFeature = 'strategy'">
          <div class="feature-icon strategy">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
            </svg>
          </div>
          <div class="feature-info">
            <span class="feature-name">ç­–ç•¥æ¨è</span>
            <span class="feature-desc">ä¸ªæ€§åŒ–æŠ•èµ„ç­–ç•¥</span>
          </div>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
        </div>
        <div class="feature-card" @click="activeFeature = 'risk'">
          <div class="feature-icon risk">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            </svg>
          </div>
          <div class="feature-info">
            <span class="feature-name">é£é™©è¯„ä¼°</span>
            <span class="feature-desc">æŠ•èµ„ç»„åˆé£é™©åˆ†æ</span>
          </div>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
        </div>
        <div class="feature-card" @click="activeFeature = 'news'">
          <div class="feature-icon news">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6"/><path d="M16 13H8M16 17H8M10 9H8"/>
            </svg>
          </div>
          <div class="feature-info">
            <span class="feature-name">å¿«è®¯è§£è¯»</span>
            <span class="feature-desc">å®æ—¶æ–°é—»æ·±åº¦åˆ†æ</span>
          </div>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
        </div>
      </div>

      <!-- AI å¯¹è¯åŒº -->
      <div class="ai-chat">
        <div class="chat-title">
          <span>æ™ºèƒ½åŠ©æ‰‹</span>
          <button class="clear-btn" @click="clearChat">æ¸…ç©ºå¯¹è¯</button>
        </div>
        <div class="chat-messages" ref="chatContainer">
          <div v-for="(msg, index) in messages" :key="index" :class="['message', msg.role]">
            <div v-if="msg.role === 'assistant'" class="msg-avatar">
              <svg viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="8" fill="#8B5CF6"/>
                <circle cx="12" cy="12" r="3" fill="#fff"/>
              </svg>
            </div>
            <div class="msg-content">
              <div class="msg-text" v-html="msg.content"></div>
              <span class="msg-time">{{ msg.time }}</span>
            </div>
          </div>
          <div v-if="isTyping" class="message assistant">
            <div class="msg-avatar">
              <svg viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="8" fill="#8B5CF6"/>
                <circle cx="12" cy="12" r="3" fill="#fff"/>
              </svg>
            </div>
            <div class="msg-content">
              <div class="typing-indicator">
                <span></span><span></span><span></span>
              </div>
            </div>
          </div>
        </div>
        <div class="chat-input">
          <input 
            type="text" 
            v-model="inputText" 
            placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..."
            @keyup.enter="sendMessage"
          >
          <button class="send-btn" :class="{ active: inputText.trim() }" @click="sendMessage">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M2 21l21-9L2 3v7l15 2-15 2v7z"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- çƒ­é—¨é—®é¢˜ -->
      <div class="hot-questions">
        <div class="section-title">çƒ­é—¨é—®é¢˜</div>
        <div class="question-list">
          <button 
            v-for="(q, index) in hotQuestions" 
            :key="index"
            class="question-btn"
            @click="askQuestion(q)"
          >{{ q }}</button>
        </div>
      </div>
    </div>
  </PageLayout>
</template>

<script setup>
import { ref, nextTick } from 'vue'
import PageLayout from '../components/layout/PageLayout.vue'

const inputText = ref('')
const isTyping = ref(false)
const activeFeature = ref('')
const chatContainer = ref(null)

const messages = ref([
  {
    role: 'assistant',
    content: 'æ‚¨å¥½ï¼æˆ‘æ˜¯å‡è¾¾æ™ºèƒ½AIåŠ©æ‰‹ï¼Œå¯ä»¥ä¸ºæ‚¨æä¾›<strong>è¡Œæƒ…åˆ†æ</strong>ã€<strong>ç­–ç•¥æ¨è</strong>ã€<strong>é£é™©è¯„ä¼°</strong>ç­‰æœåŠ¡ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®æ‚¨çš„å—ï¼Ÿ',
    time: 'åˆšåˆš'
  }
])

const hotQuestions = [
  'ä»Šå¤©BTCèµ°åŠ¿å¦‚ä½•ï¼Ÿ',
  'AGXå€¼å¾—æŠ•èµ„å—ï¼Ÿ',
  'å¦‚ä½•è®¾ç½®æ­¢æŸæ­¢ç›ˆï¼Ÿ',
  'é»„é‡‘å’Œæ¯”ç‰¹å¸æ€ä¹ˆé…ç½®ï¼Ÿ'
]

const scrollToBottom = () => {
  nextTick(() => {
    if (chatContainer.value) {
      chatContainer.value.scrollTop = chatContainer.value.scrollHeight
    }
  })
}

const sendMessage = () => {
  if (!inputText.value.trim()) return
  
  const userMsg = inputText.value
  messages.value.push({
    role: 'user',
    content: userMsg,
    time: new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })
  })
  
  inputText.value = ''
  isTyping.value = true
  scrollToBottom()
  
  // æ¨¡æ‹ŸAIå›å¤
  setTimeout(() => {
    isTyping.value = false
    let response = ''
    
    if (userMsg.includes('BTC') || userMsg.includes('æ¯”ç‰¹å¸')) {
      response = 'æ ¹æ®æŠ€æœ¯åˆ†æï¼ŒBTCç›®å‰å¤„äº<strong>ä¸Šå‡é€šé“</strong>ä¸­ï¼š<br><br>ğŸ“ˆ <strong>æ”¯æ’‘ä½</strong>ï¼š98,500 USDT<br>ğŸ“Š <strong>é˜»åŠ›ä½</strong>ï¼š102,000 USDT<br>ğŸ’¡ <strong>å»ºè®®</strong>ï¼šå¯åœ¨æ”¯æ’‘ä½é™„è¿‘é€¢ä½å»ºä»“ï¼Œæ­¢æŸè®¾åœ¨97,000<br><br>âš ï¸ æŠ•èµ„æœ‰é£é™©ï¼Œä»¥ä¸Šä»…ä¾›å‚è€ƒ'
    } else if (userMsg.includes('AGX')) {
      response = 'AGXå‡è¾¾é‡‘æŒ‡å¸æ˜¯ç”±<strong>å®ç‰©é»„é‡‘èƒŒä¹¦</strong>çš„æ•°å­—èµ„äº§ï¼š<br><br>âœ… é»„é‡‘å‚¨å¤‡ç»å¾·å‹¤å®¡è®¡<br>âœ… å‘è¡Œä»·$0.10ï¼Œå³å°†ä¸Šçº¿<br>âœ… é”ä»“ç†è´¢å¹´åŒ–é«˜è¾¾128%<br><br>ğŸ’¡ ä½œä¸ºé»„é‡‘+åŒºå—é“¾çš„åˆ›æ–°äº§å“ï¼Œå…·æœ‰<strong>æŠ—é€šèƒ€</strong>å’Œ<strong>ä»·å€¼å­˜å‚¨</strong>å±æ€§ï¼Œå€¼å¾—å…³æ³¨ï¼'
    } else if (userMsg.includes('æ­¢æŸ') || userMsg.includes('æ­¢ç›ˆ')) {
      response = 'æ­¢æŸæ­¢ç›ˆè®¾ç½®å»ºè®®ï¼š<br><br>ğŸ“Œ <strong>æ­¢æŸ</strong>ï¼šä¸€èˆ¬è®¾åœ¨ä¹°å…¥ä»·çš„3-5%ä»¥ä¸‹<br>ğŸ“Œ <strong>æ­¢ç›ˆ</strong>ï¼šæ ¹æ®é£é™©åå¥½ï¼Œå¯è®¾10-20%<br>ğŸ“Œ <strong>ç§»åŠ¨æ­¢æŸ</strong>ï¼šéšç€ç›ˆåˆ©å¢åŠ é€æ­¥ä¸Šç§»æ­¢æŸä½<br><br>ğŸ’¡ å»ºè®®ä½¿ç”¨<strong>1:2</strong>æˆ–<strong>1:3</strong>çš„ç›ˆäºæ¯”ç­–ç•¥'
    } else if (userMsg.includes('é»„é‡‘')) {
      response = 'é»„é‡‘é…ç½®å»ºè®®ï¼š<br><br>ğŸ’° é»„é‡‘æ˜¯ä¼ ç»Ÿçš„é¿é™©èµ„äº§<br>â‚¿ æ¯”ç‰¹å¸æ˜¯æ•°å­—é»„é‡‘<br><br>ğŸ“Š <strong>å»ºè®®é…æ¯”</strong>ï¼š<br>- ä¿å®ˆå‹ï¼šé»„é‡‘70% + BTC30%<br>- å‡è¡¡å‹ï¼šé»„é‡‘50% + BTC50%<br>- æ¿€è¿›å‹ï¼šé»„é‡‘30% + BTC70%<br><br>ğŸ’¡ AGXå®Œç¾ç»“åˆä¸¤è€…ä¼˜åŠ¿ï¼Œå€¼å¾—å…³æ³¨ï¼'
    } else {
      response = 'æ„Ÿè°¢æ‚¨çš„æé—®ï¼ä½œä¸ºæ‚¨çš„AIæŠ•èµ„é¡¾é—®ï¼Œæˆ‘å¯ä»¥ä¸ºæ‚¨ï¼š<br><br>1ï¸âƒ£ åˆ†æå¸‚åœºè¡Œæƒ…èµ°åŠ¿<br>2ï¸âƒ£ æ¨èä¸ªæ€§åŒ–æŠ•èµ„ç­–ç•¥<br>3ï¸âƒ£ è¯„ä¼°æŠ•èµ„ç»„åˆé£é™©<br>4ï¸âƒ£ è§£è¯»å®æ—¶é‡‘èå¿«è®¯<br><br>è¯·é—®æ‚¨æƒ³äº†è§£å“ªæ–¹é¢çš„å†…å®¹ï¼Ÿ'
    }
    
    messages.value.push({
      role: 'assistant',
      content: response,
      time: new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })
    })
    scrollToBottom()
  }, 1500)
}

const askQuestion = (question) => {
  inputText.value = question
  sendMessage()
}

const clearChat = () => {
  messages.value = [{
    role: 'assistant',
    content: 'å¯¹è¯å·²æ¸…ç©ºï¼Œæœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®æ‚¨çš„å—ï¼Ÿ',
    time: 'åˆšåˆš'
  }]
}
</script>

<style scoped>
.ai-page {
  width: 100%;
  max-width: 428px;
  min-height: 100vh;
  min-height: 100dvh;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  background: linear-gradient(180deg, #181a20 0%, #131518 50%, #0c0e12 100%);
  -webkit-tap-highlight-color: transparent;
}

/* å›ºå®šé¡¶éƒ¨æ  */
.page-header {
  position: sticky;
  top: 0;
  z-index: 100;
  display: flex;
  align-items: center;
  padding: 12px 16px;
  background: linear-gradient(180deg, rgba(139, 92, 246, 0.1) 0%, #181a20 100%);
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);
}

.back-btn {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-secondary);
  background: rgba(255, 255, 255, 0.04);
  border-radius: 10px;
  margin-right: 12px;
}

.back-btn:active { background: rgba(255, 255, 255, 0.08); }

.page-title {
  flex: 1;
  font-size: 18px;
  font-weight: 600;
  color: var(--text-primary);
  margin: 0;
}

.header-actions { display: flex; gap: 8px; }

.header-btn {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-secondary);
  background: rgba(255, 255, 255, 0.04);
  border-radius: 10px;
}

.header-btn:active { background: rgba(255, 255, 255, 0.08); }

.page-content {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  padding-bottom: max(24px, env(safe-area-inset-bottom));
}

.page-content::-webkit-scrollbar { display: none; }
.page-content { scrollbar-width: none; }

.ai-header {
  text-align: center;
  padding: 30px 16px;
  background: linear-gradient(180deg, rgba(139, 92, 246, 0.1) 0%, transparent 100%);
}

.ai-avatar {
  position: relative;
  width: 80px;
  height: 80px;
  margin: 0 auto 16px;
}

.ai-avatar svg { width: 100%; height: 100%; }

.ai-pulse {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 100px;
  height: 100px;
  border: 2px solid rgba(139, 92, 246, 0.3);
  border-radius: 50%;
  animation: pulse 2s ease-out infinite;
}

@keyframes pulse {
  0% { transform: translate(-50%, -50%) scale(0.8); opacity: 1; }
  100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
}

.ai-title {
  font-size: 24px;
  font-weight: 700;
  color: #eaecef;
  margin-bottom: 8px;
}

.ai-desc {
  font-size: 14px;
  color: #848e9c;
}

.ai-features {
  padding: 0 16px;
  margin-bottom: 20px;
}

.feature-card {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 16px;
  background: #1e2329;
  border-radius: 14px;
  margin-bottom: 10px;
  cursor: pointer;
  transition: all 0.15s;
}

.feature-card:active { transform: scale(0.99); background: #242930; }

.feature-icon {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.feature-icon.analysis { background: rgba(14, 203, 129, 0.15); color: #0ECB81; }
.feature-icon.strategy { background: rgba(96, 165, 250, 0.15); color: #60A5FA; }
.feature-icon.risk { background: rgba(246, 70, 93, 0.15); color: #F6465D; }
.feature-icon.news { background: rgba(168, 85, 247, 0.15); color: #A855F7; }

.feature-info { flex: 1; }

.feature-name {
  display: block;
  font-size: 15px;
  font-weight: 500;
  color: #eaecef;
  margin-bottom: 4px;
}

.feature-desc {
  font-size: 12px;
  color: #5e6673;
}

.feature-card > svg { color: #5e6673; }

.ai-chat {
  margin: 0 16px 20px;
  background: #1e2329;
  border-radius: 16px;
  overflow: hidden;
}

.chat-title {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 16px;
  border-bottom: 1px solid rgba(255,255,255,0.06);
  font-size: 14px;
  font-weight: 500;
  color: #eaecef;
}

.clear-btn {
  font-size: 12px;
  color: #5e6673;
  background: none;
  border: none;
  cursor: pointer;
}

.chat-messages {
  height: 300px;
  overflow-y: auto;
  padding: 16px;
}

.chat-messages::-webkit-scrollbar { display: none; }

.message {
  display: flex;
  gap: 10px;
  margin-bottom: 16px;
}

.message.user {
  flex-direction: row-reverse;
}

.msg-avatar {
  width: 32px;
  height: 32px;
  flex-shrink: 0;
}

.msg-avatar svg { width: 100%; height: 100%; }

.msg-content {
  max-width: 80%;
}

.msg-text {
  padding: 12px 16px;
  border-radius: 16px;
  font-size: 14px;
  line-height: 1.6;
}

.message.assistant .msg-text {
  background: #2B3139;
  color: #eaecef;
  border-bottom-left-radius: 4px;
}

.message.user .msg-text {
  background: linear-gradient(135deg, #8B5CF6, #6366F1);
  color: #fff;
  border-bottom-right-radius: 4px;
}

.msg-time {
  display: block;
  font-size: 11px;
  color: #5e6673;
  margin-top: 6px;
  padding: 0 4px;
}

.message.user .msg-time { text-align: right; }

.typing-indicator {
  display: flex;
  gap: 4px;
  padding: 12px 16px;
  background: #2B3139;
  border-radius: 16px;
  border-bottom-left-radius: 4px;
}

.typing-indicator span {
  width: 8px;
  height: 8px;
  background: #5e6673;
  border-radius: 50%;
  animation: typing 1.4s infinite;
}

.typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
.typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

@keyframes typing {
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-6px); }
}

.chat-input {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  border-top: 1px solid rgba(255,255,255,0.06);
}

.chat-input input {
  flex: 1;
  height: 40px;
  padding: 0 16px;
  background: #2B3139;
  border: none;
  border-radius: 20px;
  color: #eaecef;
  font-size: 14px;
  outline: none;
}

.chat-input input::placeholder { color: #5e6673; }

.send-btn {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: #2B3139;
  color: #5e6673;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
}

.send-btn.active {
  background: linear-gradient(135deg, #8B5CF6, #6366F1);
  color: #fff;
}

.hot-questions {
  padding: 0 16px;
}

.section-title {
  font-size: 14px;
  font-weight: 500;
  color: #848e9c;
  margin-bottom: 12px;
}

.question-list {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.question-btn {
  padding: 10px 16px;
  background: #1e2329;
  border: 1px solid rgba(139, 92, 246, 0.2);
  border-radius: 20px;
  font-size: 13px;
  color: #A78BFA;
  cursor: pointer;
  transition: all 0.15s;
}

.question-btn:active {
  background: rgba(139, 92, 246, 0.15);
}
</style>
